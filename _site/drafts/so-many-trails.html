<!DOCTYPE html>
<html lang="en"><head>
    
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>So Many Trails | James Kitchens</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="So Many Trails" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/drafts/so-many-trails.html" />
<meta property="og:url" content="http://localhost:4000/drafts/so-many-trails.html" />
<meta property="og:site_name" content="James Kitchens" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-27T00:00:00-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="So Many Trails" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-04-27T00:00:00-07:00","datePublished":"2021-04-27T00:00:00-07:00","headline":"So Many Trails","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/drafts/so-many-trails.html"},"url":"http://localhost:4000/drafts/so-many-trails.html"}</script>
<!-- End Jekyll SEO tag -->


    <!--
    <title>So Many Trails | James Kitchens</title><meta name="thumbnail" content="https://james-kitchens.com/assets/blog/animated-website-background/thumbnail.png"/>
        <meta property="og:image" content="/assets/blog/animated-website-background/thumbnail.png" />
    

    -->

    <meta name="twitter:site"    content="@kitchensjn">
    <meta name="twitter:creator" content="@kitchensjn">

    
        <meta name="twitter:description" content="">
        <meta name="twitter:card"  content="summary">
        <meta name="twitter:image" content="">
    

    <link rel="shortcut icon" type="image/x-icon" href="/assets/logo/logo.ico">
    <script src="https://kit.fontawesome.com/b53b88607b.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.0.min.js" integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="/assets/scripts/navbar.js"></script>
    <link rel="stylesheet" href="/assets/styles/main.css">
    
    

</head><body><div id="topnav">
    
    
        <a class="section-title" id="Logo" href="/#home">
            <i class="fas fa-hiking fa-lg logo" title="James Kitchens"></i>
        </a>
        <a class="section-title" id="Home" href="/#home">Home</a>
        <a class="section-title" id="Bio" href="/#bio">Bio</a>
        
            <a class="section-title" id="Projects" href="/#projects">Projects</a>
        
            <a class="section-title" id="Blog" href="/#blog">Blog</a>
        
    
    
    
        <a class="section-title" id="CV" href="/assets/CV/KitchensJames_CV.pdf" target="_blank">CV</a>
    
    
    <a href="javascript:void(0);" class="burger" onclick="hamburger()">
        <i class="fa fa-bars"></i>
    </a>
    
</div><div class="section"><h2 class="postTitle">
    So Many Trails</h2><p style="text-align: left;">James Kitchens</p><p style="text-align: left;">April 27, 2021</p>
<div class="cat">
    
        <div class="background">
            <p class="skill">Hiking</p>
        </div>
    
        <div class="background">
            <p class="skill">Running</p>
        </div>
    
        <div class="background">
            <p class="skill">Python</p>
        </div>
    
</div>

            <p class="images"><img src="/assets/blog/animated-website-background/animated-website-background-1.gif" alt="Animated Website Background - 1" /></p>

<p>During quarantine, I started running again with the intentions of training for the Los Angeles Marathon. Unfortunately, the 2021 LA Marathon was postponed to the fall, leaving me searching for new running goals. Coming from the hiking world, I’ve always been more interested in trail running than road running. I recently visited Black Star Canyon in Cleveland National Forest, climbing up to North Main Divide (FR 3S04). The road seemed to go on endlessly in both directions, and so, intrigued by the concept of following it to its terminus, I pulled up CalTopo and started mapping out a route across the forest. Quickly, the scope of this thought experiment quickly grew out of hand, far beyond my original intentions, yet it still remains a really entertaining focus for learning some new skills. While I am still very much in the middle of development, I wanted to take some time to document my progress.</p>

<h3 id="north-main-divide-fr-3s04">North Main Divide (FR 3S04)</h3>

<p>North Main Divide is a forest road that runs north-south along the ridge through the Santa Ana Mountains in the northern Cleveland National Forest. It is approximately 32 miles long and popular for off-road vehicles and bicycles. Though these mountains are bordered by the Los Angeles Metropolitan Area, they can feel remote and rugged. North Main Divide does not cross any paved roads between its termini, with a number of smaller spur trails that connecting the various canyon trailheads, such as Black Star Canyon, mentioned earlier. It crests nearly at the summit of Santiago Peak, the highest point in the Santa Ana Mountains. I was impressed with how defined and continuous the route was and began thinking about the possibility of an ultramarathon race that utilized this route.</p>

<h3 id="the-original-santa-ana-100k">The Original Santa Ana 100K</h3>

<p>My first attempt at creating a 100K ultramarathon course came together really quickly. Starting with the 32 mile long North Main Divide, I extended the route northwards, connecting with Chino Hills State Park, and traversing eastwards to Carbon Canyon. To fill out the final miles in the southern portion of the course, I plotted out a short 3 mile route to Lakeside High School in Lake Elsinore. The Lakeside High School track seemed like an ideal place to start the race course since it has plenty of parking and space for when there will be the highest concentration of racers.</p>

<p>Normally during a 100K race, there are aid stations distributed along the course that provide resupply and medical help to racers. When I first imagined the route, I liked the opportunity for creating a remote route so close to LA, but in creating the route in this way, I also increased many logistical difficulties regarding access and safety. While running along the North Main Divide, there aren’t any access points for vehicles, requiring a multi-mile hike in if you wanted to set up an aid station. This would make the feel much more similar to an unsupported 100K, at least through this long section.</p>

<p>In addition to some of the obvious logistical challenges, there is a much a more pressing issue with the current route. After descending out of Cleveland National Forest, the course passing under the highway and then through a small golf course before entering Chino Hills State Park. Between the golf course and the park is a railroad crossing that seemed inconspicuous enough, but some of my friends who have actually run that section pointed out that it is actually illegal to cross. Unfortunately, this roadblock means that the dream of this current route becoming a race has been halted. So what next?</p>

<h3 id="santa-ana-ultras-race-series">Santa Ana Ultras Race Series</h3>

<p>There are so many trails within Cleveland National Forest, that it is still very possible to have a 100K point to point race within the bounds of the forest. Coincidentally, forcing runners off of North Main Divide may also make logistics easier and allow for a few aid stations along the route. Joe Nakamura, my boss at Run Republic, and I have been brainstorming some possible routes. There are currently two ultras put on in the forest, Harding Hustle 50K and Chimera 50K. We want to avoid overlapping with those courses as much as possible to ensure that each race is unique.</p>

<p>We’ve come up with three races.</p>

<h3 id="a-need-for-organization">A Need For Organization</h3>

<p>As we created more routes, I wanted to visualize them together in a website. This seemed like the perfect opportunity to build my familiarity with Django Web Framework and utilize Python for processing the route information. Initially, routes were created with CalTopo which allows users to export as a CSV. I developed a short Python function that converts the CSV into a GeoJSON object, which can then be added to the Leaflet map.</p>

<p class="codeheader">views.py</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">"POST"</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">POST</span>
        <span class="n">caltopo</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">FILES</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"caltopo"</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">caltopo</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>

        <span class="n">json_string</span> <span class="o">=</span> <span class="s">'{"features":[{"geometry":{"coordinates":['</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">first</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
        <span class="n">json_string</span> <span class="o">+=</span> <span class="s">'['</span> <span class="o">+</span> <span class="n">first</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">','</span> <span class="o">+</span> <span class="n">first</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">']'</span>
        <span class="n">distances</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="n">first</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
            <span class="n">json_string</span> <span class="o">+=</span> <span class="s">',['</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">','</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">']'</span>
            <span class="n">distances</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>

        <span class="n">json_string</span> <span class="o">+=</span> <span class="s">'],"type":"LineString"},"type":"Feature"}],"type":"FeatureCollection"}'</span>
        <span class="n">max_dist</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>

        <span class="n">trail</span> <span class="o">=</span> <span class="n">Trail</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"name"</span><span class="p">],</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"description"</span><span class="p">],</span>
            <span class="n">json</span> <span class="o">=</span> <span class="n">json_string</span><span class="p">,</span>
            <span class="n">total_distance</span> <span class="o">=</span> <span class="n">max_dist</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
            <span class="n">TrailData</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">trail</span><span class="p">,</span>
                <span class="n">latitude</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">longitude</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">distance_meters</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">distance_miles</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                <span class="n">elevation_meters</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                <span class="n">elevation_feet</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                <span class="n">slope</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
                <span class="n">aspect</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="s">"add"</span><span class="p">)</span>

    <span class="k">return</span> <span class="nf">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">"home/add.html"</span><span class="p">)</span>
</code></pre></div></div>

<p>Normally, you would want to use a database which supports spatial objects, such as SPATIALite or PostGIS. Because I wanted to keep this project relatively small, I stuck with SQLite and stored the GeoJSON as a string. This does not scale well for larger applications and lacks any spatial processing capabilities, such as filtering and buffering, but is very easily implemented. The database contains two tables, Trail and TrailData. Trail stores general information about the trail (name, description, geojson, and distance). TrailData contains the coordinates which make up the trail. The route information is added to both tables automatically when you upload a route. For my purpose, the Trail table is used for the mapping and the TrailData is used for the elevation plots of each route.</p>

<p>I created a Django template for displaying the maps and elevation data for route:</p>

<p class="codeheader">template/course.html (map and elevation)</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://d3js.org/d3.v4.js"</span><span class="nt">&gt;&lt;/script&gt;</span>


{% for c in courses %}
    {% if forloop.first %}
        <span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"overview"</span> <span class="na">style=</span><span class="s">"margin-top: 56px;"</span><span class="nt">&gt;</span>
    {% else %}
        <span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"overview {% cycle 'reverse' '' %}"</span><span class="nt">&gt;</span>
    {% endif %}
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"title-tall"</span><span class="nt">&gt;</span>{{ c.name }}<span class="nt">&lt;/p&gt;</span>
            {% with function_name="leaflet_" %}
                {% with primary=c.pk|stringformat:"i" %}
                    {% leaflet_map function_name|add:primary callback=function_name|add:primary %}
                {% endwith %}
            {% endwith %}
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"info"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"title-wide"</span><span class="nt">&gt;</span>{{ c.name }}<span class="nt">&lt;/p&gt;</span>
                {% with function_name="d3_" %}
                    {% with primary=c.pk|stringformat:"i" %}
                        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">{{</span> <span class="na">function_name</span><span class="err">|</span><span class="na">add:primary</span> <span class="err">}}</span> <span class="na">class=</span><span class="s">"elevation"</span><span class="nt">&gt;&lt;/div&gt;</span>
                    {% endwith %}
                {% endwith %}
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"desc-wide"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;p</span> <span class="na">style=</span><span class="s">"font-size: 25px; margin-bottom: 0px;"</span><span class="nt">&gt;</span>Course Description<span class="nt">&lt;/p&gt;</span>
                    <span class="nt">&lt;p&gt;</span>{{ c.description }}<span class="nt">&lt;/p&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/section&gt;</span>
{% endfor %}

<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
    <span class="kd">function</span> <span class="nf">map_init</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="kd">var</span> <span class="nx">streets</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">tileLayer</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">attribution</span><span class="p">:</span> <span class="dl">'</span><span class="s1">&amp;copy; &lt;a href="https://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; contributors</span><span class="dl">'</span>
        <span class="p">})</span>
        <span class="c1">// create a satellite imagery layer</span>
        <span class="kd">var</span> <span class="nx">satellite</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nf">tileLayer</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">attribution</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Tiles &amp;copy; Esri &amp;mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community</span><span class="dl">'</span>
        <span class="p">});</span>
        <span class="c1">// create an object to hold layer names as you want them to appear in the basemap switcher list</span>
        <span class="kd">var</span> <span class="nx">basemaps</span> <span class="o">=</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">Streets</span><span class="dl">"</span><span class="p">:</span> <span class="nx">streets</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">Satellite</span><span class="dl">"</span><span class="p">:</span> <span class="nx">satellite</span>
        <span class="p">};</span>

        <span class="nx">streets</span><span class="p">.</span><span class="nf">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
        <span class="c1">// display the control (switcher list) on the map, by default in the top right corner</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">control</span><span class="p">.</span><span class="nf">layers</span><span class="p">(</span><span class="nx">basemaps</span><span class="p">).</span><span class="nf">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">course</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nf">geoJSON</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="p">{</span><span class="na">style</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">color</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">#F15A29</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">weight</span><span class="dl">"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">opacity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}}).</span><span class="nf">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
        <span class="nx">map</span><span class="p">.</span><span class="nf">fitBounds</span><span class="p">(</span><span class="nx">course</span><span class="p">.</span><span class="nf">getBounds</span><span class="p">(),</span> <span class="p">{</span><span class="na">padding</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">]});</span>
        <span class="nx">map</span><span class="p">.</span><span class="nx">scrollWheelZoom</span><span class="p">.</span><span class="nf">disable</span><span class="p">();</span>

    <span class="p">}</span>

    <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="nx">c</span> <span class="k">in</span> <span class="nx">courses</span> <span class="o">%</span><span class="p">}</span>
        <span class="kd">function</span> <span class="nf">leaflet_</span><span class="p">{{</span><span class="nx">c</span><span class="p">.</span><span class="nx">pk</span><span class="p">}}(</span><span class="nx">map</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">map_init</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="dl">'</span><span class="s1">{{ c.json | safe }}</span><span class="dl">'</span><span class="p">));</span>
            <span class="kd">var</span> <span class="nx">circle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nf">circleMarker</span><span class="p">([</span><span class="mf">33.7595</span><span class="p">,</span> <span class="o">-</span><span class="mf">117.5719</span><span class="p">],</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">fillColor</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">#BF1E2D</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">fillOpacity</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">weight</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">radius</span><span class="dl">"</span><span class="p">:</span> <span class="mi">5</span>
            <span class="p">});</span>
            <span class="kd">var</span> <span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="dl">'</span><span class="s1">{{ courses_data | safe }}</span><span class="dl">'</span><span class="p">);</span>
            <span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span> <span class="o">=</span> <span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}.</span><span class="nf">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}};})</span>
            
            <span class="c1">// set the dimensions and margins of the graph</span>
            <span class="kd">var</span> <span class="nx">margin</span> <span class="o">=</span> <span class="p">{</span><span class="na">top</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="na">right</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">bottom</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="na">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">};</span>
            <span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">right</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="mi">300</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">bottom</span><span class="p">;</span>

            <span class="c1">// append the svg object to the body of the page</span>
            <span class="kd">var</span> <span class="nx">elevation_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="dl">"</span><span class="s2">#d3_</span><span class="dl">"</span> <span class="o">+</span> <span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span><span class="o">|</span><span class="na">stringformat</span><span class="p">:</span><span class="dl">"</span><span class="s2">i</span><span class="dl">"</span> <span class="p">}})</span>
                <span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">svg</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">max-width</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">1000</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">viewBox</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">0 0 1000 300</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">perserveAspectRatio</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">xMinYMid</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">g</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">transform</span><span class="dl">"</span><span class="p">,</span>
                    <span class="dl">"</span><span class="s2">translate(</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">,</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">)</span><span class="dl">"</span><span class="p">);</span>

            <span class="c1">// Add X axis</span>
            <span class="kd">var</span> <span class="nx">x_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nf">scaleLinear</span><span class="p">()</span>
                <span class="p">.</span><span class="nf">domain</span><span class="p">([</span><span class="nx">d3</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">+</span><span class="nx">d</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">];</span> <span class="p">}),</span> <span class="nx">d3</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">+</span><span class="nx">d</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">];</span> <span class="p">})])</span>
                <span class="c1">//.domain([0, d3.max(data, function(d) { return +d.Rescaled; })])</span>
                <span class="p">.</span><span class="nf">range</span><span class="p">([</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span> <span class="p">]);</span>

            <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">elevation_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}.</span><span class="nf">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">g</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">transform</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">translate(0,</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">height</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">)</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nf">axisBottom</span><span class="p">(</span><span class="nx">x_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}).</span><span class="nf">tickSize</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">tickValues</span><span class="p">([</span><span class="mi">0</span><span class="p">]).</span><span class="nf">tickFormat</span><span class="p">(</span><span class="dl">"</span><span class="s2">Start</span><span class="dl">"</span><span class="p">))</span>
                <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">class</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">axisRed</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">text-anchor</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">start</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">font-size</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">20px</span><span class="dl">"</span><span class="p">);</span>
            
            <span class="kd">var</span> <span class="nx">finish</span> <span class="o">=</span> <span class="nx">elevation_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}.</span><span class="nf">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">g</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">transform</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">translate(0,</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">height</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">)</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nf">axisBottom</span><span class="p">(</span><span class="nx">x_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}).</span><span class="nf">tickSize</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">tickValues</span><span class="p">([</span><span class="nx">d3</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">+</span><span class="nx">d</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">];</span> <span class="p">})]).</span><span class="nf">tickFormat</span><span class="p">(</span><span class="dl">"</span><span class="s2">Finish</span><span class="dl">"</span><span class="p">))</span>
                <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">class</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">axisRed</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">text-anchor</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">end</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">font-size</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">20px</span><span class="dl">"</span><span class="p">);</span>

            <span class="c1">// Add Y axis</span>
            <span class="kd">var</span> <span class="nx">y_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nf">scaleLinear</span><span class="p">()</span>
                <span class="p">.</span><span class="nf">domain</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">d3</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">+</span><span class="nx">d</span><span class="p">[</span><span class="dl">"</span><span class="s2">elevation_feet</span><span class="dl">"</span><span class="p">];</span> <span class="p">})])</span>
                <span class="p">.</span><span class="nf">range</span><span class="p">([</span><span class="nx">height</span><span class="p">,</span> <span class="mi">0</span><span class="p">]);</span>

            <span class="nx">elevation_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}.</span><span class="nf">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">datum</span><span class="p">(</span><span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}})</span>
                <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">fill</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">#F15A29</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">d</span><span class="dl">"</span><span class="p">,</span> <span class="nx">d3</span><span class="p">.</span><span class="nf">area</span><span class="p">()</span>
                    <span class="c1">//.curve(d3.curveMonotoneX)</span>
                    <span class="p">.</span><span class="nf">x</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}(</span><span class="nx">d</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">])</span> <span class="p">})</span>
                    <span class="p">.</span><span class="nf">y0</span><span class="p">(</span><span class="nx">y_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}(</span><span class="mi">0</span><span class="p">))</span>
                    <span class="p">.</span><span class="nf">y1</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">y_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}(</span><span class="nx">d</span><span class="p">[</span><span class="dl">"</span><span class="s2">elevation_feet</span><span class="dl">"</span><span class="p">])</span> <span class="p">})</span>
                <span class="p">);</span>
            
            <span class="c1">// This allows to find the closest X index of the mouse:</span>
            <span class="kd">var</span> <span class="nx">bisect</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nf">bisector</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">d</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">];}).</span><span class="nx">left</span><span class="p">;</span>
            
            <span class="c1">// Create the circle that travels along the curve of chart</span>
            <span class="kd">var</span> <span class="nx">focusLine_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span> <span class="o">=</span> <span class="nx">elevation_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span>
                <span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">g</span><span class="dl">'</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">line</span><span class="dl">'</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">fill</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">none</span><span class="dl">"</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">stroke</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">white</span><span class="dl">"</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">stroke-width</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">2</span><span class="dl">"</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">y1</span><span class="dl">"</span><span class="p">,</span> <span class="nx">y_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}(</span><span class="nx">d3</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">+</span><span class="nx">d</span><span class="p">[</span><span class="dl">"</span><span class="s2">elevation_feet</span><span class="dl">"</span><span class="p">];</span> <span class="p">})</span> <span class="o">/</span> <span class="mi">10</span><span class="p">))</span>

            <span class="kd">var</span> <span class="nx">focusCircle_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span> <span class="o">=</span> <span class="nx">elevation_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span>
                <span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">g</span><span class="dl">'</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">circle</span><span class="dl">'</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">fill</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">#BF1E2D</span><span class="dl">"</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">stroke</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">#BF1E2D</span><span class="dl">"</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">'</span><span class="s1">r</span><span class="dl">'</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">opacity</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1">// Create the text that travels along the curve of chart</span>
            <span class="kd">var</span> <span class="nx">focusText_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span> <span class="o">=</span> <span class="nx">elevation_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span>
                <span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">g</span><span class="dl">'</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">text</span><span class="dl">'</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">fill</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">white</span><span class="dl">"</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">opacity</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">alignment-baseline</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">y</span><span class="dl">"</span><span class="p">,</span> <span class="nx">y_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}(</span><span class="nx">d3</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">+</span><span class="nx">d</span><span class="p">[</span><span class="dl">"</span><span class="s2">elevation_feet</span><span class="dl">"</span><span class="p">];</span> <span class="p">})</span> <span class="o">/</span> <span class="mi">25</span><span class="p">))</span>

            <span class="c1">// Create a rect on top of the svg area: this rectangle recovers mouse position</span>
            <span class="nx">elevation_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span>
                <span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">rect</span><span class="dl">'</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">fill</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">none</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">pointer-events</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">all</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">'</span><span class="s1">width</span><span class="dl">'</span><span class="p">,</span> <span class="nx">width</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">'</span><span class="s1">height</span><span class="dl">'</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">mouseover</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseover_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}})</span>
                <span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mousemove_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}})</span>
                <span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">mouseout</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseout_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}});</span>
        
            <span class="c1">// What happens when the mouse move -&gt; show the annotations at the right positions.</span>
            <span class="kd">function</span> <span class="nf">mouseover_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}()</span> <span class="p">{</span>
                <span class="nx">focusLine_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">opacity</span><span class="dl">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="nx">focusCircle_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">opacity</span><span class="dl">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="nx">focusText_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">opacity</span><span class="dl">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="nx">circle</span><span class="p">.</span><span class="nf">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="kd">function</span> <span class="nf">mousemove_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}()</span> <span class="p">{</span>
                <span class="c1">// recover coordinate we need</span>
                <span class="kd">var</span> <span class="nx">x0</span> <span class="o">=</span> <span class="nx">x_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}.</span><span class="nf">invert</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nf">mouse</span><span class="p">(</span><span class="k">this</span><span class="p">)[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nf">bisect</span><span class="p">(</span><span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}},</span> <span class="nx">x0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="nx">selectedData</span> <span class="o">=</span> <span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}[</span><span class="nx">i</span><span class="p">];</span>
                <span class="nx">circle</span><span class="p">.</span><span class="nf">setLatLng</span><span class="p">([</span><span class="nx">selectedData</span><span class="p">[</span><span class="dl">"</span><span class="s2">latitude</span><span class="dl">"</span><span class="p">],</span> <span class="nx">selectedData</span><span class="p">[</span><span class="dl">"</span><span class="s2">longitude</span><span class="dl">"</span><span class="p">]]);</span>
                <span class="nx">focusLine_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span>
                    <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">x1</span><span class="dl">"</span><span class="p">,</span> <span class="nx">x_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}(</span><span class="nx">selectedData</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">]))</span>
                    <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">x2</span><span class="dl">"</span><span class="p">,</span> <span class="nx">x_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}(</span><span class="nx">selectedData</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">]))</span>
                    <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">y2</span><span class="dl">"</span><span class="p">,</span> <span class="nx">y_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}(</span><span class="nx">selectedData</span><span class="p">[</span><span class="dl">"</span><span class="s2">elevation_feet</span><span class="dl">"</span><span class="p">]))</span>
                <span class="nx">focusCircle_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span>
                    <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">cx</span><span class="dl">"</span><span class="p">,</span> <span class="nx">x_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}(</span><span class="nx">selectedData</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">]))</span>
                    <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">cy</span><span class="dl">"</span><span class="p">,</span> <span class="nx">y_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}(</span><span class="nx">selectedData</span><span class="p">[</span><span class="dl">"</span><span class="s2">elevation_feet</span><span class="dl">"</span><span class="p">]))</span>
                <span class="nx">focusText_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span>
                    <span class="p">.</span><span class="nf">html</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="nx">selectedData</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span> <span class="o">+</span> <span class="dl">"</span><span class="s2"> miles / </span><span class="dl">"</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="nx">selectedData</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_meters</span><span class="dl">"</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span> <span class="o">+</span> <span class="dl">"</span><span class="s2"> km / </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">selectedData</span><span class="p">[</span><span class="dl">"</span><span class="s2">elevation_feet</span><span class="dl">"</span><span class="p">]</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">'</span><span class="dl">"</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">x</span><span class="dl">"</span><span class="p">,</span> <span class="nx">x_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}(</span><span class="nx">selectedData</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">]))</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">selectedData</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">d3</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">+</span><span class="nx">d</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">];</span> <span class="p">})</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">focusText_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span>
                        <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">text-anchor</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">start</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="nf">if </span><span class="p">(</span><span class="nx">selectedData</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">d3</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="nx">data_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">+</span><span class="nx">d</span><span class="p">[</span><span class="dl">"</span><span class="s2">distance_miles</span><span class="dl">"</span><span class="p">];</span> <span class="p">})</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">focusText_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span>
                        <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">text-anchor</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">end</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span>  <span class="p">{</span>
                    <span class="nx">focusText_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}</span>
                        <span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">text-anchor</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">middle</span><span class="dl">"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="kd">function</span> <span class="nf">mouseout_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}()</span> <span class="p">{</span>
                <span class="nx">focusLine_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">opacity</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="nx">focusCircle_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">opacity</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="nx">focusText_</span><span class="p">{{</span> <span class="nx">c</span><span class="p">.</span><span class="nx">pk</span> <span class="p">}}.</span><span class="nf">style</span><span class="p">(</span><span class="dl">"</span><span class="s2">opacity</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="nx">map</span><span class="p">.</span><span class="nf">removeLayer</span><span class="p">(</span><span class="nx">circle</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">{</span><span class="o">%</span> <span class="nx">endfor</span> <span class="o">%</span><span class="p">}</span>

<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>


        </div>
    <div id="contact" class="contactBar">

        <p class="info">kitchensjn@gmail.com</p>
    </div></body>

</html>